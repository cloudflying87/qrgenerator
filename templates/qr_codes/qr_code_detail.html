{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/apps/qr_codes.css' %}">
{% endblock %}

{% block title %}{{ qr_code.name }}{% endblock %}

{% block content %}
<h1>{{ qr_code.name }}</h1>

<div class="analytics-grid">
    <div class="stat-card">
        <div class="stat-card__value">{{ qr_code.total_scans }}</div>
        <div class="stat-card__label">Total Scans</div>
    </div>
    <div class="stat-card">
        <div class="stat-card__value">{{ qr_code.unique_scans }}</div>
        <div class="stat-card__label">Unique Scans</div>
    </div>
    <div class="stat-card">
        <div class="stat-card__value">
            <span class="status-badge status-badge--{{ qr_code.status }}">{{ qr_code.get_status_display }}</span>
        </div>
        <div class="stat-card__label">Status</div>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <h3>QR Code</h3>
        <div class="qr-preview">
            <img src="{% url 'qr_codes:download' qr_code.pk %}" alt="{{ qr_code.name }}" class="qr-preview__image" style="max-width: 300px;">
            {% if short_url %}
            <div class="qr-preview__url">{{ short_url }}</div>
            {% endif %}
        </div>

        <div class="mt-3">
            <p><strong>Destination:</strong> {{ qr_code.destination_url }}</p>
            <p><strong>Type:</strong> {{ qr_code.get_qr_type_display }}</p>
            {% if qr_code.description %}
            <p><strong>Description:</strong> {{ qr_code.description }}</p>
            {% endif %}
        </div>

        <div class="btn-group mt-3">
            <a href="{% url 'qr_codes:download' qr_code.pk %}" class="btn btn-primary">Download QR Code</a>
            <a href="{% url 'qr_codes:edit' qr_code.pk %}" class="btn btn-outline">Edit</a>
            <a href="{% url 'qr_codes:analytics' qr_code.pk %}" class="btn btn-outline">View Analytics</a>
        </div>
    </div>
</div>

{% if recent_scans %}
<div class="card mt-3">
    <div class="card-header">
        <h3>Recent Scans</h3>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="qr-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Device</th>
                        <th>Browser</th>
                        <th>Location</th>
                    </tr>
                </thead>
                <tbody>
                    {% for scan in recent_scans %}
                    <tr>
                        <td>{{ scan.scanned_at|date:"Y-m-d H:i" }}</td>
                        <td>{{ scan.device_type }}</td>
                        <td>{{ scan.browser }}</td>
                        <td>{{ scan.city|default:"Unknown" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}
